<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECB Data Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 20px;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        .chart-container {
            height: 400px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ECB Data Integration Test</h1>
        
        <div id="status" class="status info">
            Initializing ECB data fetcher...
        </div>
        
        <div id="data-display">
            <h2>Current ECB Rates</h2>
            <div id="current-rates"></div>
            
            <h2>Historical Data Test</h2>
            <div class="chart-container">
                <canvas id="testChart"></canvas>
            </div>
        </div>
    </div>

    <script src="ecb-data.js"></script>
    <script>
        async function testECBData() {
            const statusDiv = document.getElementById('status');
            const currentRatesDiv = document.getElementById('current-rates');
            
            try {
                statusDiv.className = 'status info';
                statusDiv.textContent = 'Creating ECB Data Fetcher...';
                
                // Create ECB Data Fetcher
                const ecbFetcher = new ECBDataFetcher();
                
                statusDiv.textContent = 'Fetching current rates...';
                
                // Test current rates
                const currentRates = await ecbFetcher.getCurrentRates();
                
                statusDiv.className = 'status success';
                statusDiv.textContent = 'ECB data fetched successfully!';
                
                // Display current rates
                currentRatesDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                        <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h3>Main Refinancing Rate</h3>
                            <p style="font-size: 24px; font-weight: bold; color: #002147;">${currentRates.refi?.value || 'N/A'}%</p>
                            <p style="color: #666;">${currentRates.refi?.trend || 'N/A'}</p>
                        </div>
                        <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h3>Deposit Facility Rate</h3>
                            <p style="font-size: 24px; font-weight: bold; color: #28a745;">${currentRates.deposit?.value || 'N/A'}%</p>
                            <p style="color: #666;">${currentRates.deposit?.trend || 'N/A'}</p>
                        </div>
                        <div style="padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
                            <h3>Marginal Lending Rate</h3>
                            <p style="font-size: 24px; font-weight: bold; color: #dc3545;">${currentRates.lending?.value || 'N/A'}%</p>
                            <p style="color: #666;">${currentRates.lending?.trend || 'N/A'}</p>
                        </div>
                    </div>
                `;
                
                // Test historical data
                statusDiv.textContent = 'Fetching historical data...';
                const allRates = await ecbFetcher.fetchAllRates();
                
                // Create test chart
                const ctx = document.getElementById('testChart');
                if (ctx && allRates.refi) {
                    const latestYear = Math.max(...allRates.refi.data.map(year => year.year));
                    const yearData = allRates.refi.data.find(year => year.year === latestYear);
                    
                    if (yearData) {
                        new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: yearData.labels,
                                datasets: [{
                                    label: `Main Refinancing Rate (${yearData.year})`,
                                    data: yearData.values,
                                    borderColor: '#002147',
                                    backgroundColor: 'rgba(0, 33, 71, 0.1)',
                                    borderWidth: 3,
                                    fill: true,
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'ECB Main Refinancing Rate - Historical Data'
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return `${context.dataset.label}: ${context.parsed.y}%`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: false,
                                        ticks: {
                                            callback: function(value) {
                                                return value + '%';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }
                
                statusDiv.className = 'status success';
                statusDiv.textContent = 'ECB data integration test completed successfully! All charts and data are working.';
                
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `Error: ${error.message}`;
                console.error('ECB data test failed:', error);
            }
        }
        
        // Run test when page loads
        document.addEventListener('DOMContentLoaded', testECBData);
    </script>
</body>
</html> 